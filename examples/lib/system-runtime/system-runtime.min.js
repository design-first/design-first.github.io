/*
 * System Runtime
 * 
 * https://designfirst.io/systemruntime/
 * 
 * Copyright 2018 Erwan Carriou
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).runtime=e()}}(function(){return function e(n,t,r){function a(i,s){if(!t[i]){if(!n[i]){var d="function"==typeof require&&require;if(!s&&d)return d(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return a(t||e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,n,t){"use strict";t.system={name:"system-runtime",master:!1,version:"2.2.0",description:"System Runtime",schemas:{"1ac07185641fa9f":{_name:"_Behavior",_inherit:["_Component"],_core:!0,core:"property",component:"property",action:"property",state:"property",useCoreAPI:"property",_id:"1ac07185641fa9f"},"104ad1f48518376":{_id:"104ad1f48518376",_name:"_Channel",_inherit:["_Component"],_core:!0,send:"event",$systemInstalled:"event",$systemResolved:"event",$systemStarted:"event",$systemStopped:"event",$systemUninstalled:"event"},"1c00b13a1b1bc92":{_name:"_ClassInfo",_inherit:["_Component"],_core:!0,model:"property",schema:"property",method:"method",methods:"method",property:"method",properties:"method",link:"method",links:"method",collections:"method",collection:"method",event:"method",events:"method",_id:"1c00b13a1b1bc92"},"111df11e2b19fde":{_id:"111df11e2b19fde",_name:"_Component",_inherit:[],_core:!0,classInfo:"property",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event"},"1723516a30132ac":{_name:"_Database",_inherit:["_Component"],_core:!0,collections:"method",insert:"event",update:"event",remove:"event",_id:"1723516a30132ac"},f1a10d1067d1b23a:{_id:"f1a10d1067d1b23a",_name:"_Log",_inherit:["_Component"],_core:!0,action:"property",collection:"property",id:"property",field:"property",value:"property",order:"property"},"1268f1dddd1fea7":{_name:"_Logger",_core:!0,level:"property",debug:"method",info:"method",warn:"method",error:"method",_id:"1268f1dddd1fea7"},"14caa1c46414ee1":{_name:"_Message",_inherit:["_Component"],_core:!0,event:"property",from:"property",data:"property",_id:"14caa1c46414ee1"},"193f1166eb16609":{_name:"_Metamodel",_inherit:["_Component"],_core:!0,schema:"method",model:"method",type:"method",create:"method",_id:"193f1166eb16609"},"157931f7a31b61d":{_id:"157931f7a31b61d",_name:"_OSGi",_inherit:["_Component"],_core:!0,install:"method",uninstall:"method",start:"method",stop:"method",status:"method",bundle:"method"},"12e211d4cd120a6":{_id:"12e211d4cd120a6",_name:"_Runtime",_inherit:["_OSGi"],_core:!0,version:"property",system:"method",message:"method",ready:"event"},"158711d6f215e4b":{_name:"_State",_inherit:[],_core:!0,_class:!1,state:"property",value:"property",_id:"158711d6f215e4b"},"1cb761fa4510dca":{_id:"1cb761fa4510dca",_name:"_System",_inherit:["_SystemOSGi"],_core:!0,name:"property",master:"property",version:"property",description:"property",schemas:"property",models:"property",behaviors:"property",types:"property",components:"property"},"145fe10c7514298":{_id:"145fe10c7514298",_name:"_SystemOSGi",_inherit:["_Component"],_core:!0,state:"property",location:"property",start:"method",stop:"method"}},models:{"166971fd9d107fd":{_name:"_Behavior",_core:!0,core:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},useCoreAPI:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},component:{type:"string",readOnly:!1,mandatory:!0,default:""},action:{type:"javascript",readOnly:!1,mandatory:!0,default:""},state:{type:"string",readOnly:!1,mandatory:!0,default:""},_id:"166971fd9d107fd"},"135c71078810af2":{_id:"135c71078810af2",_name:"_Channel",_core:!0,send:{params:[{name:"message",type:"message"}]},$systemInstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemResolved:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemUninstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStarted:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStopped:{params:[{name:"id",type:"string",mandatory:!0,default:""}]}},"158321dced1014a":{_name:"_ClassInfo",_core:!0,model:{type:"object",readOnly:!0,mandatory:!0,default:{}},property:{params:[{name:"name",type:"string"}],result:"object"},properties:{result:"array"},link:{params:[{name:"name",type:"string"}],result:"object"},links:{result:"array"},method:{params:[{name:"name",type:"string"}],result:"object"},methods:{result:"array"},collection:{params:[{name:"name",type:"string"}],result:"object"},collections:{result:"array"},event:{params:[{name:"name",type:"string"}],result:"object"},events:{result:"array"},_id:"158321dced1014a",schema:{type:"object",readOnly:!0,mandatory:!0,default:{}}},"123751cb591de26":{_id:"123751cb591de26",_name:"_Component",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1,default:!1},{name:"isCore",type:"boolean",mandatory:!1,default:!1}]},off:{params:[{name:"state",type:"string",mandatory:!1},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{type:"_ClassInfo",readOnly:!1,mandatory:!1,default:{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}},"18a51169d7112d4":{_name:"_Database",_core:!0,collections:{result:"object"},insert:{params:[{name:"event",type:"dbInsertEvent"}]},update:{params:[{name:"event",type:"dbUpdateEvent"}]},remove:{params:[{name:"event",type:"dbRemoveEvent"}]},_id:"18a51169d7112d4"},o1e1e01e6b41cec3:{_id:"o1e1e01e6b41cec3",_name:"_Log",action:{type:"dbAction",readOnly:!1,mandatory:!1,default:"insert"},collection:{type:"string",readOnly:!1,mandatory:!1,default:""},id:{type:"string",readOnly:!1,mandatory:!1,default:""},field:{type:"string",readOnly:!1,mandatory:!1,default:""},value:{type:"any",readOnly:!1,mandatory:!1,default:""},order:{type:"number",readOnly:!1,mandatory:!1,default:0},_core:!0},"16b9d1ac2216ffe":{_id:"16b9d1ac2216ffe",_name:"_Logger",_core:!0,level:{type:"log",readOnly:!1,mandatory:!1,default:"warn"},debug:{params:[{name:"message",type:"any"}]},info:{params:[{name:"message",type:"any"}]},warn:{params:[{name:"message",type:"any"}]},error:{params:[{name:"message",type:"any"}]}},"1d9b6139411aa91":{_name:"_Message",_core:!0,event:{type:"string",readOnly:!1,mandatory:!0,default:""},from:{type:"string",readOnly:!1,mandatory:!0,default:""},data:{type:"array",readOnly:!1,mandatory:!0,default:[]},_id:"1d9b6139411aa91"},"1628c13c22152e6":{_name:"_Metamodel",_core:!0,schema:{params:[{name:"schema",type:"object"}],result:"any"},model:{params:[{name:"model",type:"object"}],result:"any"},type:{params:[{name:"type",type:"object"}],result:"any"},create:{params:[]},_id:"1628c13c22152e6"},"100b91ed2211b15":{_id:"100b91ed2211b15",_name:"_OSGi",install:{params:[{name:"url",type:"any",mandatory:!0,default:""},{name:"async",type:"boolean",mandatory:!1,default:!0}],result:"string"},uninstall:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},start:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},stop:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},status:{result:"object"},_core:!0,bundle:{result:"string"}},"14c7c105b31a160":{_id:"14c7c105b31a160",_name:"_Runtime",_core:!0,version:{type:"string",readOnly:!0,mandatory:!0,default:"0.0.0"},system:{params:[{name:"params",type:"any",mandatory:!1}],result:"object"},message:{params:[{name:"msg",type:"message",mandatory:!0}]},ready:{}},"177ac136891629f":{_name:"_State",_core:!0,state:{type:"string",readOnly:!1,mandatory:!0,default:""},value:{type:"any",readOnly:!1,mandatory:!1,default:null},_id:"177ac136891629f"},"170521b88614387":{_name:"_System",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,default:""},master:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},version:{type:"string",readOnly:!1,mandatory:!1,default:"0.0.1"},description:{type:"string",readOnly:!1,mandatory:!1,default:""},schemas:{type:"object",readOnly:!1,mandatory:!1,default:{}},models:{type:"object",readOnly:!1,mandatory:!1,default:{}},behaviors:{type:"object",readOnly:!1,mandatory:!1,default:{}},types:{type:"object",readOnly:!1,mandatory:!1,default:{}},components:{type:"object",readOnly:!1,mandatory:!1,default:{}},_id:"170521b88614387"},"1b2811b092143f5":{_id:"1b2811b092143f5",_name:"_SystemOSGi",start:{},stop:{},_core:!0,state:{type:"string",readOnly:!1,mandatory:!1,default:"none"},location:{type:"string",readOnly:!1,mandatory:!1,default:""}}},behaviors:{"12e491859c13918":{_id:"12e491859c13918",component:"_Channel",state:"$systemStarted",action:"function $systemStarted(id) { \n  var systems = null;\n    \n  if (id !== 'e89c617b6b15d24') {\n    if (typeof document !== 'undefined') {\n      systems = document.querySelectorAll('link[rel=system]');\n         \n      if ($state.get('runtime') && $state.get('runtime').state === 'ready') {    \n      } else {\n        if (systems.length + 1 === $db._System.count()) {\n          $component.get('runtime').ready();\n        }\n      }\n    }\n  }\n}",useCoreAPI:!0,core:!0},"1e9021bd4e1bc6e":{_id:"1e9021bd4e1bc6e",component:"_Channel",state:"$systemInstalled",action:"function $systemInstalled(id) {\n  var systems = null,\n    dependencies = [],\n    master = [],\n    canStart = true;\n\n  if (id !== 'e89c617b6b15d24') {\n    // if all systems are installed\n    systems = $db._System.find({});\n\n    systems.forEach(function (system) {\n      var sys = this.require(system._id);\n      if (sys && sys.state && sys.state() === 'none') {\n        canStart = false;\n      }\n    }.bind(this));\n\n    // start all the systems\n    if (canStart) {\n      dependencies = $db._System.find({\n        'master': false\n      });\n\n      dependencies.forEach(function (dep) {\n        var system = this.require(dep._id);\n        channel = this.require('channel');\n\n        if (system.state() === 'resolved') {\n          system.state('starting');\n          system.start();\n          channel.$systemStarted(dep._id);\n          system.state('active');\n        }\n      }.bind(this));\n\n      master = $db._System.find({\n        'master': true\n      });\n\n      master.forEach(function (dep) {\n        var system = this.require(dep._id);\n        channel = this.require('channel');\n\n        if (system && system.state && system.state() === 'resolved') {\n          system.state('starting');\n          system.start();\n          channel.$systemStarted(dep._id);\n          system.state('active');\n        }\n      }.bind(this));\n    }\n  }\n}",useCoreAPI:!0,core:!0},"155141e40312cd8":{_id:"155141e40312cd8",component:"_ClassInfo",state:"collection",action:"function collection(name) {\n  var result = {};\n  if (this.schema()[name] === 'collection') {\n    result = this.model()[name];\n  }\n\n  return result;\n}",core:!0},"1f6941a0c012c1f":{_id:"1f6941a0c012c1f",component:"_ClassInfo",state:"collections",action:"function collections(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'collection') {\n      result.push(item);\n    }\n  }\n\n  return result;\n}",core:!0},"1ef711b4171c849":{_id:"1ef711b4171c849",component:"_ClassInfo",state:"event",action:"function event(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'event') {\n    result = this.model()[name];\n  }\n\n  return result;\n}",core:!0},"1bae51b6ed1d25c":{_id:"1bae51b6ed1d25c",component:"_ClassInfo",state:"events",action:"function events(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'event') {\n      result.push(item);\n    }\n  }\n  return result;\n}",core:!0},"19ac2125221528b":{_id:"19ac2125221528b",component:"_ClassInfo",state:"link",action:"function link(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'link') {\n    result = this.model()[name];\n  }\n  return result;\n}",core:!0},"17ed21dfc01b8e8":{_id:"17ed21dfc01b8e8",component:"_ClassInfo",state:"links",action:"function links(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'link') {\n      result.push(item);\n    }\n  } return result;\n}",core:!0},"11ce318a561ac61":{_id:"11ce318a561ac61",component:"_ClassInfo",state:"method",action:"function method(name) {\n  var result = {};\n  if (this.schema()[name] === 'method') {\n    result = this.model()[name];\n  }\n  \n  return result;\n}",core:!0},"12ff2190a018046":{_id:"12ff2190a018046",component:"_ClassInfo",state:"methods",action:"function methods(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'method') {\n      result.push(item);\n    }\n  }\n\n  return result;\n}",core:!0},"1028d1681e1fd58":{_id:"1028d1681e1fd58",component:"_ClassInfo",state:"properties",action:"function properties(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'property') {\n      result.push(item);\n    }\n  } return result;\n}",core:!0},"18eeb10c5319368":{_id:"18eeb10c5319368",component:"_ClassInfo",state:"property",action:"function property(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'property') {\n    result = this.model()[name];\n  }\n  return result;\n}",core:!0},"1ba721201114b6b":{_id:"1ba721201114b6b",component:"_Component",state:"destroy",action:"function destroy() {\n  $component.destroy(this.id());\n}",core:!0,useCoreAPI:!0},"15486186f41a48c":{_id:"15486186f41a48c",component:"_Component",state:"off",action:'function off(state, behaviorId) {\n  var args = [],\n    i = 0,\n    length = arguments.length;\n\n  for (i = 0; i < length - 7; i++) {\n    args.push(arguments[i]);\n  }\n\n  if ($workflow.checkParams({\n    "component": this,\n    "methodName": "off",\n    "args": args\n  })) {\n\n    if (state || behaviorId) {\n      if ($metamodel.isValidState(state, this.constructor.name)) {\n        $behavior.remove({\n          "behaviorId": behaviorId,\n          "componentId": this.id(),\n          "state": state\n        });\n      } else {\n        this.require(\'logger\').warn("invoke \\\'off\\\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'");\n      }\n    } else {\n      $behavior.remove({\n        "componentId": this.id()\n      });\n    }\n  }\n}',core:!0,useCoreAPI:!0},"1da0a17878104c3":{_id:"1da0a17878104c3",component:"_Component",state:"require",action:"function require(id) {\n  return $component.get(id);\n}",core:!0,useCoreAPI:!0},"1a5111d17a1800c":{_id:"1a5111d17a1800c",component:"_Database",state:"collections",action:"function collections() {\n  var result = {},\n    collectionName = '';\n\n  for (collectionName in $db.store) {\n    if ($db.store.hasOwnProperty(collectionName) && collectionName.indexOf('_') !== 0) {\n      result[collectionName] = $db[collectionName];\n    }\n  }\n  return result;\n}",core:!0,useCoreAPI:!0},"1d993108fa18ef2":{_id:"1d993108fa18ef2",component:"_Logger",state:"debug",action:"function debug(message) {\n  if (this.level() === 'debug') {\n    console.log('runtime: ' + message);\n  }\n}",core:!0},"1a37a188e11fe73":{_id:"1a37a188e11fe73",component:"_Logger",state:"error",action:"function error(message) {\n  console.error('runtime: ' + message);\n}",core:!0},"1edd21e12a16534":{_id:"1edd21e12a16534",component:"_Logger",state:"info",action:"function info(message) {\n  if (this.level() === 'info' || this.level() === 'debug') {\n    console.info('runtime: ' + message);\n  }\n}",core:!0},"141f2143d3122a4":{_id:"141f2143d3122a4",component:"_Logger",state:"level",action:"function level(val) {\n  $log.level(val);\n}",core:!0,useCoreAPI:!0},"192401bab21304e":{_id:"192401bab21304e",component:"_Logger",state:"warn",action:"function warn(message) {\n  if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\n    console.warn('runtime: ' + message);\n  }\n}",core:!0},"11fc715e2f1a31e":{_id:"11fc715e2f1a31e",component:"_Metamodel",state:"create",action:"function create() {\n  $metamodel.create();\n}",core:!0,useCoreAPI:!0},"1232f1f107142cf":{_id:"1232f1f107142cf",component:"_Metamodel",state:"model",action:"function model(model) {\n  return $metamodel.model(model);\n}",core:!0,useCoreAPI:!0},"1365412f69153d2":{_id:"1365412f69153d2",component:"_Metamodel",state:"schema",action:"function schema(schema) {\n  return $metamodel.schema(schema);\n}",core:!0,useCoreAPI:!0},"194db147fe161a2":{_id:"194db147fe161a2",component:"_Metamodel",state:"type",action:"function type(type) {\n  return $metamodel.type(type);\n}",core:!0,useCoreAPI:!0},"1ef951f1411b895":{_id:"1ef951f1411b895",component:"_OSGi",state:"install",action:"function install(url, async) {\n  var importedSystem = null,\n    system = {},\n    systemId = '',\n    callbackLoad = null,\n    xhr = null,\n    result = '',\n    channel = $component.get('channel');\n\n  if (typeof url === 'object') {\n    importedSystem = url;\n  } else {\n    if (url.indexOf('{') === 0) {\n      importedSystem = JSON.parse(url);\n    }\n  }\n\n  if (importedSystem) {\n    systemId = $db.importSystem(importedSystem);\n    if (systemId) {\n      system = this.require(systemId);\n\n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');\n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n\n      result = systemId;\n    }\n  } else {\n    if (typeof global !== 'undefined' && typeof window === 'undefined') {\n      if (url.indexOf('.json') !== -1) {\n        system = global.require(global.process.env.PWD + '/' + url);\n      } else {\n        system = global.require(url);\n      }\n      systemId = $db.importSystem(system);\n      system = this.require(systemId);\n\n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');\n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n\n      result = systemId;\n    } else {\n      xhr = new XMLHttpRequest();\n      callbackLoad = function callbackLoad(system, url) {\n        var sysId = $db.importSystem(system),\n          sys = $component.get(sysId),\n          channel = $component.get('channel');\n\n        if (typeof url === 'string') {\n          sys.location(url);\n        }\n        sys.state('installed');\n        channel.$systemInstalled(sysId);\n        sys.state('resolved');\n        channel.$systemResolved(sysId);\n\n        result = sysId;\n      };\n\n      if (async) {\n        xhr.open('GET', url, true);\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200 || xhr.status === 0) {\n              callbackLoad(JSON.parse(xhr.response), url);\n            }\n          }\n        };\n        xhr.send(null);\n      } else {\n        xhr.open('GET', url, false);\n        xhr.send(null);\n        if (xhr.status === 200 || xhr.status === 0) {\n          callbackLoad(JSON.parse(xhr.response), url);\n        }\n      }\n    }\n  }\n  return result;\n}",useCoreAPI:!0,core:!0},"14c1517b711cb78":{_id:"14c1517b711cb78",component:"_OSGi",state:"uninstall",action:"function uninstall(id) {\n  var search = {},\n    system = null,\n    behaviorId = '',\n    collection = '',\n    componentId = '',\n    length = 0,\n    i = 0,\n    coreComponents = ['admin', 'channel', 'db', 'logger', 'metamodel', 'runtime'];\n\n  search = $db._System.find({\n    '_id': id\n  });\n\n  if (search.length) {\n    system = search[0];\n    // remove behaviors\n    if (system.behaviors) {\n      for (behaviorId in system.behaviors) {\n        $db._Behavior.remove({\n          '_id': system.behaviors[behaviorId]._id\n        });\n      }\n    }\n    // remove components\n    if (system.components) {\n      for (collection in system.components) {\n        for (componentId in system.components[collection]) {\n          if (coreComponents.indexOf(componentId) === -1) {\n            $db[collection].remove({\n              '_id': componentId\n            });\n          }\n        }\n      }\n    }\n  }\n  if (this.require(id) && this.require(id).state) {\n    this.require(id).state('uninstalled');\n    channel.$systemUninstalled(id);\n  }\n}",useCoreAPI:!0,core:!0},"105f219c6813643":{_id:"105f219c6813643",component:"_OSGi",state:"start",action:"function start(id) {\n  var system = this.require(id),\n    channel = this.require('channel');\n\n  if (system.state() === 'resolved' || system.state() === 'installed') {\n    system.state('starting');\n    if (system.start) {\n      system.start();\n    }\n    channel.$systemStarted(id);\n    system.state('active');\n  }\n}",useCoreAPI:!1,core:!0},"1a81a1f00d17269":{_id:"1a81a1f00d17269",component:"_OSGi",state:"stop",action:"function stop(id) {\n  var system = this.require(id),\n    channel = this.require('channel');\n\n  if (system.state() === 'active') {\n    system.state('stopping');\n    if (system.stop) {\n      system.stop();\n    }\n    channel.$systemStopped(id);\n    system.state('resolved');\n    channel.$systemResolved(id);\n  }\n}",useCoreAPI:!1,core:!0},"116851b602128d1":{_id:"116851b602128d1",component:"_OSGi",state:"status",action:"function status() {\n  var result = {},\n    system = null,\n    length = 0,\n    i = 0;\n\n  systems = $db._System.find({});\n\n  length = systems.length;\n  for (i = 0; i < length; i++) {\n    system = systems[i];\n    result[system.name] = {\n      'id': system._id,\n      'state': system.state,\n      'name': system.name,\n      'version': system.version,\n      'location': system.location,\n      'master': system.master\n    };\n  }\n\n  return result;\n}",useCoreAPI:!0,core:!0},"19cf317d7217331":{_id:"19cf317d7217331",component:"_OSGi",state:"bundle",action:"function bundle() { \n\tvar result = $db.exportSystem();\n\treturn result;\n}",useCoreAPI:!0,core:!0},"13010167f313f87":{_id:"13010167f313f87",component:"_Runtime",state:"system",action:"function system(params) {\n  var RuntimeSystem = null,\n    system = {},\n    systemId = '',\n    result = [],\n    conf = {};\n\n  if (params) {\n    if (typeof params === 'string') {\n      conf.master = true;\n      conf.name = params;\n    } else {\n      conf = params;\n      conf.master = true;\n    }\n    RuntimeSystem = this.require('_System');\n    system = new RuntimeSystem(conf);\n    system.state('active');\n  } else {\n    result = $db._System.find({\n      'master': true\n    });\n    if (result.length) {\n      systemId = result[0]._id;\n      system = $component.get(systemId);\n    }\n  }\n  return system;\n}",core:!0,useCoreAPI:!0},"1cfa4145f614da8":{_id:"1cfa4145f614da8",component:"_Runtime",state:"message",action:"function message(msg) { \n  $db._Message.insert(msg);\n}",useCoreAPI:!0,core:!0},"1cb9d103d41dd97":{_id:"1cb9d103d41dd97",component:"e89c617b6b15d24",state:"start",action:"function start() {\n  if (typeof document !== 'undefined') {\n    document.addEventListener('DOMContentLoaded', function DOMContentLoaded(e) {\n      var systems = [],\n        system = null,\n        scripts = [],\n        script = null,\n        logLevel = 'warn',\n        i = 0,\n        length = 0;\n    \n      systems = document.querySelectorAll('link[rel=system]');\n      length = systems.length;\n  \n      // logger\n      scripts = document.querySelectorAll('script[log]');\n      if (scripts.length) {\n        logLevel = scripts[0].getAttribute('log');\n        this.require('logger').level(logLevel);\n      }\n  \n      // systems\n      for (i = 0; i < length; i++) {\n        system = systems[i];\n  \n        if (system.getAttribute('async') === 'false') {\n          this.require('runtime').install(system.href, false);\n        } else {\n          this.require('runtime').install(system.href, true);\n        }\n      }\n  \n      // ready event\n      if (length === 0) {\n        this.require('runtime').ready();\n      }\n  }.bind(this));\n  }\n}",useCoreAPI:!0,core:!0}},types:{css:{_id:"h1d88311ac019211",name:"css",type:"string",core:!0},date:{_id:"c17cad1bc3d17752",name:"date",type:"object",core:!0},json:{_id:"e1d25a12e67127ed",name:"json",type:"object",core:!0},dbInsertEvent:{_id:"148ef1e19810e6d",core:!0,name:"dbInsertEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},document:{type:"object",mandatory:!0,default:{}}}},dbRemoveEvent:{_id:"1952e1ac4213f4a",name:"dbRemoveEvent",type:"object",core:!0,schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""}}},dbUpdateEvent:{_id:"1f5c41309711752",core:!0,name:"dbUpdateEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""},field:{type:"string",mandatory:!0,default:""},value:{type:"any",mandatory:!0,default:null}}},dbAction:{_id:"e1950e16f2914da9",core:!0,name:"dbAction",type:"string",value:["insert","update","remove"]},collection:{_id:"d1c0d0130c616199",name:"collection",type:"object",schema:{type:{type:["string"],mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"object",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},errorParam:{_id:"e198761fc0b1ae8a",name:"errorParam",type:"object",schema:{message:{type:"string",mandatory:!0},error:{type:"object",mandatory:!0}},core:!0},event:{_id:"g1668d1de2d1ff6f",name:"event",type:"object",schema:{params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},html:{_id:"y161c21320b11acb",name:"html",type:"string",core:!0},javascript:{_id:"s13d4c1fdf916504",name:"javascript",type:"string",core:!0},link:{_id:"p124601801d1dbfa",name:"link",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"{type}",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},log:{_id:"d1fd161a4a4149fc",name:"log",type:"string",value:["debug","info","warn","error"],core:!0},message:{_id:"l13b061ac571272d",name:"message",type:"object",schema:{event:{type:"string",mandatory:!0},from:{type:"string",mandatory:!1},data:{type:"object",mandatory:!0}},core:!0},method:{_id:"x1227218eed1f3e9",name:"method",type:"object",schema:{result:{type:"string",mandatory:!1},params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},osgiStates:{_id:"q1f0ca120fc13fb3",name:"osgiStates",type:"string",value:["none","installed","resolved","starting","active","stopping","uninstalled"],core:!0},parameter:{_id:"e1b18e16c6c195ad",name:"parameter",type:"object",schema:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},mandatory:{type:"boolean",mandatory:!1},default:{type:"{type}",mandatory:!1}},core:!0},property:{_id:"a16a3a1ae051a55d",name:"property",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"{type}",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},text:{_id:"c136fc129a912f54",name:"text",type:"string",core:!0}},components:{_Channel:{channel:{_id:"channel"}},_Database:{db:{_id:"db"}},_Logger:{logger:{_id:"logger",level:"warn"}},_Metamodel:{metamodel:{_id:"metamodel"}},_Runtime:{runtime:{_id:"runtime",version:"2.2.0"}}},_id:"e89c617b6b15d24"}},{}],2:[function(e,n,t){"use strict";var r=e("./db.js"),a=e("./helper.js"),o={};function i(e,n,t,r){var a=-1,o=[],i=[],s="",d="",c=!0,l=!1;return 0===n.trim().indexOf("function")&&(c=!1),c?(a=n.indexOf("=>"),(o=(-1!==(d=(d=n.substring(0,a)).replace("=>","")).indexOf("(")?d.split("(")[1].replace(")","").trim():d.trim()).split(",")).forEach(function(e){i.push(e.trim())}),0===(s=n.substring(a+2,n.length).trim()).indexOf("{")&&(s=s.substring(1,s.lastIndexOf("}")).trim()),-1===s.indexOf("\n")&&(l=!0),c&&l&&-1===s.indexOf("return ")&&(s="return "+s)):(a=n.indexOf("{"),(o=(d=n.substring(0,a)).split("(")[1].replace(")","").trim().split(",")).forEach(function(e){i.push(e.trim())}),s=(s=n.substring(a+1)).substring(0,s.lastIndexOf("}")).trim()),""===o[0]&&(o=[]),r&&(o.push("$component"),o.push("$db"),o.push("$metamodel"),o.push("$workflow"),o.push("$behavior"),o.push("$state"),o.push("$log")),""!==o[0]?new Function("__body","return function "+e+" ("+o.join(",")+") { return new Function('"+o.join("','")+"', __body).apply(this, arguments) };")(s):new Function("__body","return function "+e+" () { return new Function(__body).apply(this, arguments) };")(s)}t.add=function(e,n,t,s,d){var c=a.generateId(),l=t.toString();return void 0===d&&(d=!1),void 0===s&&(s=!1),t=i(n,l,0,s),o[c]=t,r._Behavior.insert({_id:c,component:e,state:n,action:l,useCoreAPI:s,core:d}),c},t.remove=function(e){(e=e||{}).behaviorId=e.behaviorId||"",e.componentId=e.componentId||"",e.state=e.state||"",e.componentId&&(e.behaviorId?(r._Behavior.remove({_id:e.behaviorId,component:e.componentId,state:e.state}),delete o[e.behaviorId]):(e.state?r._Behavior.remove({component:e.componentId,state:e.state}):r._Behavior.remove({component:e.componentId})).forEach(function(e){delete o[e]}))},t.removeFromMemory=function(e){delete o[e]},t.getActions=function(e,n){var t=[],a=null;return r._Behavior.find({component:e,state:n}).forEach(function(e){void 0===(a=o[e._id])&&(a=i(e.state,e.action,e.core,e.useCoreAPI),o[e._id]=a),t.push({useCoreAPI:e.useCoreAPI,action:a})}),t},t.clear=function(){o={}},t.get=function(e){return o[e]}},{"./db.js":4,"./helper.js":5}],3:[function(e,n,t){"use strict";var r=e("./workflow.js"),a=e("./db.js"),o=e("./metamodel.js"),i=e("./behavior.js"),s=e("./helper.js"),d=e("./log.js"),c=e("./state.js"),l="property",m="link",u="collection",f="method",p="event",y="_name",h={};function g(e){var n=[],t=[],a="",i="",c="",l="",m=!1;a=(e=e||{}).type||"",i=e.id||"",l=e.propertyName||"",t=e.arr||[],c=e.classId||"",void 0!==e.readOnly&&(m=e.readOnly),t.forEach(function(e){o.isClassName(a)?n.push(s.getRuntime().require(e)):n.push(e)});function u(){var e=0,r=0,i=n.length;for(t.forEach(function(t){o.isClassName(a)?n[e]=s.getRuntime().require(t):n[e]=t,e+=1}),r=e;r<i;r++)delete n[r];n.length=t.length}function f(e,n,u,f){var p=0,y=0,g=[];if(m)d.readOnlyProperty(i,c,l);else if(o.isClassName(a))if(e&&o.inheritFrom(e.constructor.name,a.replace("@",""))){switch(!0){case"push"===n:t.push(e.id());break;case"unshift"===n:t.unshift(e.id());break;case"splice"===n:for(y=(g=t.splice(u,f,e)).length,p=0;p<y;p++)r.state({component:i,state:l,data:[h[g[p]],"remove"]})}s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),r.state({component:i,state:l,data:[e,"add"]})}else void 0!==e.id?d.invalidPropertyName(i,c,l,e.id(),a):d.invalidPropertyName(i,c,l,e,a);else if(e&&o.isValidType(e,a)){switch(!0){case"push"===n:t.push(e);break;case"unshift"===n:t.unshift(e);break;case"splice"===n:t.splice(u,f,e)}s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),r.state({component:i,state:l,data:[e,"add"]})}else d.invalidPropertyName(i,c,l,e,a);return t.length}function p(e){var n,u=null;if(m)d.readOnlyProperty(i,c,l);else if(0!==t.length){switch(!0){case"pop"===e:u=t.pop();break;case"shift"===e:u=t.shift()}s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),n=o.isClassName(a)?h[u]:u,r.state({component:i,state:l,data:[n,"remove"]})}return n}return n.push=function(e){var n=f(e,"push");return u(),n},n.unshift=function(e){var n=f(e,"unshift");return u(),n},n.concat=function(n){var r=0,a=0,o=null;if(Array.isArray(n))for(a=n.length,r=0;r<a;r++)f(n[r],"push");return e.arr=t,o=new g(e),u(),o},n.pop=function(){var e=p("pop");return u(),e},n.shift=function(){var e=p("shift");return u(),e},n.sort=function(e){var r=null;return t.sort(e),s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),r=n,u(),r},n.reverse=function(){return t.reverse(),s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),u(),n},n.splice=function(e,n,d){var m=[],p=0,y=0,g=null;if(void 0!==d)f(d,"splice",e,n);else for(m=t.splice(e,n),s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:i,field:l,value:t}),y=m.length,p=0;p<y;p++)g=o.isClassName(a)?h[m[p]]:m[p],r.state({component:i,state:l,data:[g,"remove"]});return u(),m},n.slice=function(e,n){var r=t.slice(e,n);return u(),r},n}g.prototype=[];function v(e,n){var t=[],r=[],a=0,i=0;if(t=o.getModel(e)[n].params)for(a=t.length,i=0;i<a;i++)r.push(t[i].name);return r}function _(e,n,t){var r=null,o=a.store[e][n],i=t.split("."),s=i.length,d=0;for(r=o,d=0;d<s;d++)r=r[i[d]];return r}function b(e,n,t,r){var o=null,i=a.store[e][n],s=t.split("."),d=s.length,c=0;for(o=i,c=0;c<d-1;c++)o=o[s[c]];o[s[c]]=r}function w(e,n,c){(function(e){var n=null,t=null,r=[],a=0,i=0,s=[];for(n=o.getModel(e),t=o.getSchema(n[y]),a=(r=Object.keys(t)).length,i=0;i<a;i++)t[r[i]]!==m&&t[r[i]]!==l&&t[r[i]]!==u||s.push({name:r[i],type:n[r[i]].type,readOnly:n[r[i]].readOnly});return s})(e).forEach(function(l){var m={},u="",f="",p="";u=l.name,f=l.type,p=l.readOnly;Array.isArray(f)||"array"===f?(m=function(e,n){var t=[],i=null,l=null,m=null;if(void 0===n){if(void 0===e)return new g({id:this.id(),propertyName:u,readOnly:p,classId:c,type:"array"===f?"any":f[0],arr:a.store[c][this.id()][u]});if(Array.isArray(e))!function(e,n){var t=!0;return e.forEach(function(e){o.isValidType(e,n)&&o.inheritFrom(e.constructor.name,n.replace("@",""))&&o.isClassName(n)||(t=t&&!1)}),!0}(e,"array"===f?"any":f[0])?d.invalidPropertyName(this.id(),this.constructor.name,u,e,f):(t=a[c].find({_id:this.id()})).length&&(i=t[0],m=function(e,n){var t=[];return e.forEach(function(e){if(o.isClassName(n))switch(!0){case"string"==typeof e:t.push(e);break;case void 0!==e.id:t.push(e.id());break;default:t.push(null)}else t.push(e)}),t}(e,"array"===f?"any":f[0]),r.state({component:this.id(),state:u,data:[e,"reset"]}),i[u]=m,s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:this.id(),field:u,value:i[u]}));else if("number"==typeof e){if(l=a.store[c][this.id()][u][e])return m=o.isClassName("array"===f?"array":f[0])?s.getRuntime().require(l):l}else d.invalidPropertyName(this.id(),this.constructor.name,u,e,"number")}else if(p)d.readOnlyProperty(this.id(),this.constructor.name,u);else if(o.isValidType(n,"array"===f?"any":f[0])||o.inheritFrom(n.constructor.name,"array"===f?"array":f[0].replace("@",""))&&o.isClassName("array"===f?"array":f[0])){if((t=a[c].find({_id:this.id()})).length){if(o.isClassName("array"===f?"array":f[0]))switch(!0){case"string"==typeof n:m=n;break;case void 0!==n.id:m=n.id();break;default:m=""}else m=n;(i=t[0])[u][e]=m,s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:this.id(),field:u,value:i[u]}),r.state({component:this.id(),state:u,data:[n,"add"]})}}else d.invalidPropertyName(this.id(),this.constructor.name,u,n,f)},n.prototype[u]=new Function("__body","return function "+u+" (position, value) { return __body.call(this, position, value) };")(m)):(m=function(n){var l=[],m=null,y=null;if(void 0===n){if(m=a.store[c][this.id()]){switch(!0){case o.isClassName(f):y=t.get(m[u]);break;case"date"===f:y=new Date(m[u]);break;case"json"===f:y=JSON.parse(JSON.stringify(m[u]));break;case"array"===f:y=new g({id:this.id(),propertyName:u,readOnly:p,classId:c,type:"any",arr:a.store[c][this.id()][u]});break;case o.isStructure(u,c):y=O("",u,e,this.id());break;default:y=m[u]}return y}d.destroyedComponentCall(u,this.id())}else if(p)d.readOnlyProperty(this.id(),this.constructor.name,u);else if(o.isValidType(n,f)){if((l=a[c].find({_id:this.id()})).length){switch(m=l[0],!0){case o.isClassName(f):m[u]=null===n?n:n.id();break;case"date"===f:m[u]="string"==typeof n?n:n.toISOString();break;default:m[u]=n}s.isRuntime()&&s.getRuntime().require("db")&&s.getRuntime().require("db").update({collection:c,id:this.id(),field:u,value:n}),"_Behavior"===c&&i.removeFromMemory(this.id()),r.state({component:this.id(),state:u,data:[n]})}}else d.invalidPropertyName(this.id(),this.constructor.name,u,n,f)},n.prototype[u]=new Function("__body","return function "+u+" (value) { return __body.call(this,value) };")(m))})}function O(e,n,c,l){var m={};return function(e,n){var t=null,r=null,a=[];return t=o.getModel(n)[e].type,(r=o.getType(t)).schema&&Object.keys(r.schema).forEach(function(e){r.schema[e].name=e,a.push(r.schema[e])}),a}(n,c).forEach(function(u){var f={},p="",y="",h="";p=u.name,y=u.type,h=u.readOnly,"array"===y?(f=function(t,i){var m="",u="";if(u=(m=e?m+"."+n:n)+"."+p,void 0===i){if(void 0===t)return new g({id:l,propertyName:u,readOnly:h,classId:c,type:"any",arr:_(c,l,u)});if(Array.isArray(t))!function(e,n){var t=!0;return e.forEach(function(e){o.isValidType(e,n)||(t=t&&!1)}),!0}(t,"any")?d.invalidPropertyName(l,this.constructor.name,p,t,y):a[c].find({_id:l}).length&&(b(c,l,u,t),r.state({component:l,state:u,data:[t,"reset"]}),s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:l,field:u,value:t}));else{if("number"==typeof t)return _(c,l,u)[t];d.invalidPropertyName(l,this.constructor.name,p,t,"number")}}else if(h)d.readOnlyProperty(l,this.constructor.name,p);else if(o.isValidType(i,"any")){if(a[c].find({_id:l}).length){var f=_(c,l,u);void 0===f&&(f=[]),f[t]=i,b(c,l,u,f),s.isRuntime()&&s.getRuntime().require("db").update({collection:c,id:l,field:u,value:f}),r.state({component:l,state:u,data:[f,"add"]})}}else d.invalidPropertyName(l,this.constructor.name,p,i,y)},m[p]=new Function("__body","return function "+p+" (position, value) { return __body.call(this, position, value) };")(f)):(f=function(m){var f=[],g=null,v="",w="";if(w=(v=e?v+"."+n:n)+"."+p,void 0===m){if(a.store[c][l]){switch(!0){case o.isClassName(y):g=t.get(_(c,l,w));break;case"date"===y:g=new Date(_(c,l,w));break;case"json"===y:g=JSON.parse(JSON.stringify(_(c,l,w)));break;case o.isStructure(p,c):g=O(v,p,c,l);break;default:g=_(c,l,w)}return void 0===g&&void 0!==u.default&&(g=u.default),g}d.destroyedComponentCall(w,l)}else if(h)d.readOnlyProperty(l,c,w);else if(o.isValidType(m,y)){if((f=a[c].find({_id:l})).length){switch(f[0],!0){case o.isClassName(y):b(c,l,w,m.id());break;case"date"===y:b(c,l,w,m.toISOString());break;default:b(c,l,w,m)}s.isRuntime()&&s.getRuntime().require("db")&&s.getRuntime().require("db").update({collection:c,id:l,field:w,value:m}),"_Behavior"===c&&i.removeFromMemory(l),r.state({component:l,state:w,data:[m]})}}else d.invalidPropertyName(l,c,w,m,y)},m[p]=new Function("__body","return function "+p+" (value) { return __body.call(this,value) };")(f))}),m}function k(e,n,t){(function(e){var n=null,t=null,r=[],a=0,i=0,s=[];for(n=o.getModel(e),t=o.getSchema(n[y]),a=(r=Object.keys(t)).length,i=0;i<a;i++)t[r[i]]===f&&s.push(r[i]);return s})(e).forEach(function(e){var a=v(t,e),o=a.join(","),i="",s=function(){return r.state({component:this.id(),state:e,data:arguments})},c=function(){var n=null,a=Array.prototype.slice.call(arguments);return a.shift(),arguments[0]?n=r.state({component:this.id(),state:e,data:a,context:arguments[0]}):d.unknownContext(t,e),n};o?(a.unshift("context"),i=a.join(""),n.prototype[e]=new Function("__body","return function "+e+" ("+o+") { return __body.call(this,"+o+") };")(s),"name"!==e&&(n[e]=new Function("__body","return function "+e+" ("+i+") { return __body.call(this,"+i+") };")(c))):(n.prototype[e]=new Function("__body","return function "+e+" () { return __body.call(this) };")(s),"name"!==e&&(n[e]=new Function("__body","return function "+e+" (context) { return __body.call(this, context) };")(c)))})}function S(e,n,t){(function(e){var n=null,t=null,r=[],a=0,i=0,s=[];for(n=o.getModel(e),t=o.getSchema(n[y]),a=(r=Object.keys(t)).length,i=0;i<a;i++)t[r[i]]===p&&s.push(r[i]);return s})(e).forEach(function(e){var o=v(t,e).join(","),i=function(){var n=[],o="e89c617b6b15d24",i=[],s=0,d=-1,c={};if("_Channel"===t){for((n=a._System.find({master:!0})).length&&(o=n[0]._id),c.from=o,d=arguments.length,s=0;s<d;s++)i.push(arguments[s]);c.data=i,c.event=e,a._Message.insert(c),r.state({component:this.id(),state:"send",data:[{event:c.event,from:c.from,data:c.data}]})}else r.state({component:this.id(),state:e,data:arguments})};n.prototype[e]=o?new Function("__body","return function "+e+" ("+o+") { return __body.call(this,"+o+") };")(i):new Function("__body","return function "+e+" () { return __body.call(this) };")(i)})}function j(e){var n={},l="";l=void 0===(e=e||{}).model?s.generateId():e.model,m=l,n=new Function("__body","return function "+m+" (config) { __body.call(this,config) };")(function(e){var n={};"Object"!==(e=e||{}).constructor.name&&(d.invalidConctructorParameters(e,m),e={}),o.isValidObject(e,o.getModel(m),!0,!0)||d.invalidParameters(m),o.prepareObject(e,o.getModel(m)),void 0===e._id&&(e._id=s.generateId()),h[e._id]=this,n=function(){return e._id},this.id=new Function("__body","return function id () { return __body.call(this) };")(n),o.inheritFrom(m,"_Component")&&(e.classInfo=m+"Info"),a.store[m][e._id]=e,a.createLog("insert",m,e._id,"",e),s.isRuntime()&&s.getRuntime().require("db")&&s.getRuntime().require("db").insert({collection:m,document:e}),Object.freeze(this),this.init&&this.init(e)});var m;h[l]=n,u=l,n.id=new Function("__body","return function id (prop, val) { return __body.call(this, prop, val) };")(function(){return u});var u;w(e.model,n,l),k(e.model,n,l),S(e.model,n,l),o.inheritFrom(l,"_Component")&&(y=l,n.prototype.on=new Function("__body","return function on (state, handler, useCoreAPI, isCore) { return __body.call(this,state,handler,useCoreAPI,isCore) };")(function(e,n,t,s){var l="",m="";return r.checkParams({component:this,methodName:"on",args:arguments})&&(o.isValidState(e,y)?o.isEvent(e,y)||o.isProperty(e,y)||o.isLink(e,y)||o.isCollection(e,y)||!(a._Behavior.find({component:this.id(),state:e}).length>=1)?r.validParamNumbers(y,e,n)?(l=i.add(this.id(),e,n,t,s),(m=c.get(this.id()))&&m.state===e&&r.action(l,m.value)):d.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):d.behaviorNotUnique(y,e):d.invalidStateOn(y,e)),l}),p=l,n.on=new Function("__body","return function on (state, handler, useCoreAPI, isCore) { return __body.call(this, state, handler, useCoreAPI,isCore) };")(function(e,n,t,s){var l="",m="";return r.checkParams({component:this,methodName:"on",args:arguments})&&(o.isValidState(e,p)?o.isEvent(e,p)||o.isProperty(e,p)||o.isLink(e,p)||o.isCollection(e,p)||!(a._Behavior.find({component:this.id(),state:e}).length>=1)?r.validParamNumbers(p,e,n)?(l=i.add(this.id(),e,n,t,s),(m=c.get(this.id()))&&m.state===e&&r.action(l,m.value)):d.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):d.behaviorNotUnique(p,e):d.invalidStateOn(p,e)),l}),f=l,n.off=new Function("__body","return function off (state, behaviorId) { return __body.call(this, state, behaviorId) };")(function(e,n){r.checkParams({component:this,methodName:"off",args:arguments})&&(o.isValidState(e,f)?i.remove({behaviorId:n,componentId:f,state:e}):d.invalidStateOff(f,e))}),n.destroy=new Function("__body","return function destroy () { return __body.call(this) };")(function(){var e=this.id(),n=[],t=0,o=0;for(a[e]&&(n=a[e].remove()),delete h[e],i.remove({componentId:e}),o=n.length,t=0;t<o;t++)i.remove({componentId:n[t]});r.state({component:e,state:"destroy"})}),n.classInfo=new Function("__body","return function classInfo () { return __body.call(this) };")(function(){return t.get(this.id()+"Info")}));var f,p,y;return Object.freeze(n),n}t.get=function(e){return h[e]},t.create=function(e){return j(e)},t.destroy=function(e){var n=h[e],t="";n&&(delete h[e],t=n.constructor.name,a[t].remove({_id:e}),i.remove({componentId:e}),"_Behavior"===t&&i.removeFromMemory(e))},t.removeFromMemory=function(e){delete h[e]},t.clear=function(){h={}}},{"./behavior.js":2,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],4:[function(e,n,t){"use strict";var r=e("./component.js"),a=e("./metamodel.js"),o=e("./helper.js"),i=e("./log.js"),s=e("./behavior.js"),d=e("./state.js"),c=e("./workflow.js"),l=[],m=["_Runtime","_Schema","_Model","_GeneratedModel","_Behavior","_State","_Type","_Metamodel","_Database","_System","_ClassInfo","_Message","_Channel","_Logger","_Log"],u=["_Log","_Schema","_Logger","_Model","_GeneratedModel","_State","_Type"],f=0;function p(e,n){var t=!0,r=!1,a="",o=0,i=0;for(a in e){if(void 0===n[a]){t=!1;break}if(e[a]instanceof RegExp){if(Array.isArray(n[a])&&!Array.isArray(e[a])){for(i=n[a].length,o=0;o<i;o++)if(null!==n[a][o].toString().match(e[a])){r=!0;break}t=r}else if(null===n[a].toString().match(e[a])){t=!1;break}}else if(Array.isArray(n[a])&&!Array.isArray(e[a])){if(-1===n[a].indexOf(e[a])){t=!1;break}}else if(n[a]!==e[a]){t=!1;break}}return t}function y(){var e="",n="",r=[],a=null,o=null,s=null,d={};if((r=t._System.find({master:!0})).length){a=(s=r[0])._id,d._id=a,d.name=s.name,d.description=s.description,d.version=s.version,d.master=!0,o=function(){var e={},n="",r="",a="",o=null,i=null,s=null,d=null,c=null,m="",u="",f=0,p=0,y="";if(e.schemas={},t._Schema.count())for(m in t.store._Schema)(s=JSON.parse(JSON.stringify(t.store._Schema[m])))._core||(e.schemas[m]=s);if(e.models={},t._Model.count())for(u in t.store._Model)(d=JSON.parse(JSON.stringify(t.store._Model[u])))._core||(e.models[u]=d);if(e.types={},t._Type.count())for(a in t.store._Type)(o=JSON.parse(JSON.stringify(t.store._Type[a]))).core||(e.types[o.name]=o);e.behaviors={};for(r in t.store._Behavior)delete(i=JSON.parse(JSON.stringify(t.store._Behavior[r]))).classInfo,i.core||(e.behaviors[r]=i);for(e.components={},f=l.length,p=0;p<f;p++)if(n=l[p],t[n].count()){c=JSON.parse(JSON.stringify(t.store[n]));for(y in c)delete c[y].classInfo,c[y]._core&&delete c[y];Object.keys(c).length&&(e.components[n]=c)}return e}();for(n in o)o.hasOwnProperty(n)&&(d[n]=o[n]);e=JSON.stringify(d)}else e="{}",i.masterSystemNotFound();return e}t.store={};var h=function(e){a.getSchema(e)||-1!==m.indexOf(e)?(t.store[e]={},this.name=e,-1===m.indexOf(e)&&l.push(e)):i.invalidCollectionName(e)};h.prototype.find=function(e){var n=[],r={},a="",o={};if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(a in t.store[this.name])p(e,o=t.store[this.name][a])&&void 0===r[a]&&(n.push(o),r[a]=!0)}.bind(this));else for(a in t.store[this.name])p(e,o=t.store[this.name][a])&&n.push(o);else for(a in t.store[this.name])o=t.store[this.name][a],n.push(o);return n},h.prototype.insert=function(e){var n=[],s=null,d=[];return Array.isArray(e)?n=e:n.push(e),n.forEach(function(e){var n=null,l=[];switch(!0){case"_Schema"===this.name:case"_Logger"===this.name:case"_Model"===this.name:case"_Type"===this.name:case"_GeneratedModel"===this.name:case a.isValidObject(e,a.getModel(this.name)):if(void 0===e._id&&(e._id=o.generateId()),a.prepareObject(e,a.getModel(this.name)),t.store[this.name][e._id]=e,(s=r.get(this.name))?(n=new s(e),d.push(n.id())):(t.createLog("insert",this.name,e._id,"",e),o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").insert({collection:this.name,document:e})),"_Message"===this.name&&o.isRuntime())for(var m=(l=t._Channel.find({})).length,u=0;u<m;u++)o.getRuntime().require(l[u]._id),c.state({component:l[u]._id,state:e.event,data:e.data});break;default:i.invalidDocumentOnDbInsert(e,this.name)}}.bind(this)),d},h.prototype.update=function(e,n,s){var d=this.find(e),l=0,m=0,u=d.length,f="",p=a.getModel(this.name),y="";if(void 0===(s=s||{}).upsert&&(s.upsert=s.upsert||!1),n)for(0===u&&s.upsert&&(e._id&&(n._id=e._id),this.insert(n),l+=1),m=0;m<u;m++){void 0!==n._id&&n._id!==d[m]._id&&i.updateUuid(d[m]._id,n._id,void 0!==r.get(n._id));for(f in n)void 0!==d[m][f.split(".")[0]]&&("_Schema"!==this.name&&"_Model"!==this.name&&"_GeneratedModel"!==this.name?(y="",0!==f.indexOf("_")?y=-1!==f.indexOf(".")?a.getModelPathType(this.name,f):p[f].type:a.getMetaDef()[f]&&(y=a.getMetaDef()[f].type),y?a.isValidType(n[f],y)?(d[m][f]=n[f],l+=1,t.createLog("update",this.name,d[m]._id,f,n[f]),o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").update({collection:this.name,id:d[m]._id,field:f,value:n[f]}),"array"===y?c.state({component:d[m]._id,state:f,data:[n[f],"reset"]}):c.state({component:d[m]._id,state:f,data:[n[f]]})):i.invalidPropertyTypeOnDbUpdate(this.name,d[m]._id,f,n[f],y):i.unknownPropertyOnDbUpdate(this.name,f,d[m]._id)):(d[m][f]=n[f],t.createLog("update",this.name,d[m]._id,f,n[f]),l+=1,o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").update({collection:this.name,id:d[m]._id,field:f,value:n[f]})))}return l},h.prototype.remove=function(e){var n=[],a="",i=null;if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(a in t.store[this.name])p(e,t.store[this.name][a])&&(delete t.store[this.name][a],t.createLog("remove",this.name,a,"",""),(i=r.get(a))&&i.destroy(),o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").remove({collection:this.name,id:a}),n.push(a))}.bind(this));else for(a in t.store[this.name])p(e,t.store[this.name][a])&&(delete t.store[this.name][a],t.createLog("remove",this.name,a,"",""),(i=r.get(a))&&i.destroy(),o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").remove({collection:this.name,id:a}),n.push(a));else for(a in t.store[this.name])delete t.store[this.name][a],t.createLog("remove",this.name,a,"",""),-1===u.indexOf(this.name)&&(i=r.get(a))&&i.destroy(),o.isRuntime()&&o.getRuntime().require("db")&&o.getRuntime().require("db").remove({collection:this.name,id:a}),n.push(a);return n},h.prototype.count=function(){var e=0,n="";for(n in t.store[this.name])e++;return e},t.createLog=function(e,n,r,a,i){var s=o.generateId();n=n||"",r=r||"",a=a||"",i=i||"",Object.keys(t.store._Log).length>1e3&&(t.store._Log={}),t.store._Log[s]={_id:s,action:e,collection:n,id:r,field:a,value:i,order:f++}},t.collection=function(e){t[e]=new h(e)},t.importSystem=function(e){return function(e){var n="",r="",o="",i="",s="",d="",c="",l=[];if(e){delete e.subsystem;for(i in e.types)a.type(e.types[i]);for(s in e.schemas)a.schema(e.schemas[s]);for(d in e.models)a.model(e.models[d]);a.create();for(c in e.behaviors)t._Behavior.insert(e.behaviors[c]);for(r in e.components)for(o in e.components[r])t[r].insert(e.components[r][o]);(l=t._System.find({master:!0})).length&&(l[0]._id===e._id?e.master=!0:e.master&&(l[0].master=!1)),t._System.insert(e),n=e._id}return n}(e)},t.exportSystem=function(e){return e?function(e){var n={},r=[],a="",o=0,i=0,s=null,d=null,c=null,l=null,m=null,u="";if((r=t._System.find({master:!0})).length&&(a=r[0].name),n.name=e.name||"sub_"+a,n.version=e.version||"0.0.1",n.description=e.description||"",n.schemas={},e.schemas)for(i=(r=t._Schema.find(e.schema)).length,o=0;o<i;o++)(s=r[o])._core||(n.schemas[s._id]=s);if(n.models={},e.models)for(i=(r=t._Model.find(e.models)).length,o=0;o<i;o++)(c=r[o])._core||(n.models[c._id]=c);if(n.types={},e.types)for(i=(r=t._Type.find(e.types)).length,o=0;o<i;o++)(d=r[o])._core||(n.types[d._id]=d);if(n.behaviors={},e.behaviors)for(l=t._Behavior.find(e.behaviors),i=r.length,o=0;o<i;o++)(l=r[o]).core||(n.behaviors[l._id]=l);if(n.components={},e.components)for(u in e.components)if(t[u])for(n.components[u]={},i=(r=t[u].find(e.components[u])).length,o=0;o<i;o++)m=r[o],n.components[u][m._id]=m;return JSON.stringify(n)}(e):y()},t.clear=function(){var e=0,n=0,r="";for(e=l.length,n=0;n<e;n++)r=l[n],t[r].remove();for(e=m.length,n=0;n<e;n++)r=m[n],t[r].remove()},t.init=function(){var e="",n=null;n=t._System.find({_id:"e89c617b6b15d24"})[0],t.clear(),r.clear(),a.clear(),d.clear(),s.clear(),a.init(),e=t.importSystem(n),r.get(e).start()}},{"./behavior.js":2,"./component.js":3,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],5:[function(e,n,t){"use strict";var r=e("./db.js"),a=e("./component.js"),o=null;t.isRuntime=function(){var e=!1;return r._Runtime&&r._Runtime.find().length&&(e=!0),e},t.getRuntime=function(){var e="";return o||(e=r._Runtime.find()[0]._id,o=a.get(e)),o},t.generateId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16)}return function(){var e="abcdefghijklmnopqrstuvwxyz";return e.charAt(Math.floor(Math.random()*e.length))}()+e()+e()+e()},t.polyfill=function(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var e=/function\s([^(]{1,})\(/.exec(this.toString());return e&&e.length>1?e[1].trim():""},set:function(e){}})}},{"./component.js":3,"./db.js":4}],6:[function(e,n,t){"use strict";var r=e("./metamodel.js"),a=e("./db.js"),o=e("./component.js"),i="_id",s={currentLevel:"warn",level:function(e){return e&&(this.currentLevel=e),this.currentLevel},debug:function(e){"debug"===this.currentLevel&&console.log("runtime: "+e)},info:function(e){"info"!==this.currentLevel&&"debug"!==this.currentLevel||console.info("runtime: "+e)},warn:function(e){"info"!==this.currentLevel&&"warn"!==this.currentLevel&&"debug"!==this.currentLevel||console.warn("runtime: "+e)},error:function(e){console.error("runtime: "+e)}};function d(){var e="",n=[],t=null;return r.getModel("_Logger")&&(n=a._Logger.find()).length?(e=n[0][i],t=o.get(e)?o.get(e):s):t=s,t}t.level=function(e){e},t.unknownProperty=function(e,n){var t="";t=n._name?"unknown property '"+e+"' for the definition of '"+n._name+"'":"unknown property '"+e+"' for a model",d().warn(t)},t.invalidPropertyType=function(e,n,t){d().warn("invalid type for property '"+e+"': expected type '"+n+"' instead of type '"+typeof t+"'")},t.invalidEnumValue=function(e,n){d().warn("'"+e+"' is an invalid value for the type enum '"+n+"'")},t.invalidClassName=function(e,n,t){d().warn("invalid class name for component '"+e+"': expected '"+n+"' instead of '"+t+"'")},t.missingProperty=function(e){d().warn("missing property '"+e+"'")},t.missingImplementation=function(e){d().warn("schema '"+e+"' is missing.")},t.invalidTypeImp=function(e,n){d().error("the property '"+e+"' of the model '"+n+"' is invalid")},t.missingPropertyImp=function(e,n){d().warn("missing property '"+e+"' for the definition of '"+n+"'")},t.unknownPropertyImp=function(e,n){d().error("the model '"+n+"' has an unknown property '"+e+"'")},t.invalidTypeDefinition=function(e){d().warn("the type '"+e+"' is not valid")},t.invalidPropertyName=function(e,n,t,r,a){var o="";"Function"!==n&&(o=" (class '"+n+"')"),"string"==typeof a?d().warn("invalid type for property '"+t+"' on component '"+e+"'"+o+": expected '"+a.replace("@","")+"' instead of '"+typeof r+"'"):d().warn("invalid type for property type '"+t+"' on component '"+o+": expected 'string' instead of '"+typeof a+"'")},t.readOnlyProperty=function(e,n,t){var r="";"Function"!==n&&(r=" (class '"+n+"')"),d().warn("can not set read-only property '"+t+"' on component '"+e+"'"+r)},t.invalidDocumentOnDbInsert=function(e,n){d().warn("invalid document '"+JSON.stringify(e).replace(/,/g,", ")+"' on an insert operation on collection '"+n+"'")},t.invalidPropertyTypeOnDbUpdate=function(e,n,t,r,a){d().warn("invalid type when trying to update the property '"+t+"' of document '"+n+"' (collection '"+e+"') with the value '"+JSON.stringify(r)+"': expected type '"+a+"'")},t.unknownPropertyOnDbUpdate=function(e,n,t){d().warn("unknown property '"+e+"' on an update operation on collection '"+n+"' with component '"+t+"'")},t.unknownMethod=function(e,n){d().warn("try to call an unknown method '"+n+"' for the class '"+e+"'")},t.invalidCollectionName=function(e){d().warn("invalid name for creating the collection '"+e+"': there is no schema '"+e+"' in the metamodel")},t.invalidResultType=function(e,n,t,r,a){var o="";"Function"!==n&&(o=" (class '"+n+"')"),a?d().warn("invalid type for the result of method '"+t+"' on component '"+e+"'"+o+": expected type '"+r.replace("@","")+"' instead of type '"+a+"'"):d().warn("invalid type for the result of method '"+t+"' on component '"+e+"'"+o+": expected type '"+r.replace("@","")+"'")},t.unknownComponent=function(e,n){d().warn("unkown class component '"+e+"' for component '"+n+"'")},t.workflowRestarted=function(){d().warn("runtime has been restarted")},t.invalidParamNumber=function(e,n,t){var r="";"Function"!==n&&(r=" (class '"+n+"')"),d().warn("invalid number of parameters when calling the method '"+t+"' on component '"+e+"'"+r)},t.invalidParamType=function(e,n,t,r){var a="";"Function"!==n&&(a=" (class '"+n+"')"),void 0!==r?d().warn("invalid type for the parameter '"+r+"' when calling the method '"+t+"' on component '"+e+"'"+a):d().warn("invalid type for a parameter when calling the method '"+t+"' on component '"+e+"'"+a)},t.behaviorNotUnique=function(e,n){d().warn("try to add more than one behavior for the state '"+n+"' on class '"+e+"'")},t.invalidStateOn=function(e,n){d().warn("try to add a behavior with an unkwown state '"+n+"' on class '"+e+"'")},t.invalidStateOff=function(e,n){d().warn("try to remove a behavior from an unkwown state '"+n+"' on class '"+e+"'")},t.masterSystemNotFound=function(){d().warn("can not export the database because no system was defined")},t.invalidType=function(e,n){d().warn("invalid type for value '"+JSON.stringify(e)+"': expected '"+n+"'")},t.unknownType=function(e){d().warn("unknown type for value '"+JSON.stringify(e)+"'")},t.canNotYetValidate=function(e,n){d().debug("can not yet validate if the component '"+e+"' is an instance of '"+n+"'")},t.invalidChannelEvent=function(e,n,t){d().warn("invalid type for the message '"+JSON.stringify(e)+"': expected type '"+t+"' for event '"+n+"'")},t.invalidParamNumberMethodOn=function(e,n,t){var r="";"Function"!==n&&(r=" (class '"+n+"')"),d().warn("invalid number of parameters when adding an action on method '"+t+"' on component '"+e+"'"+r)},t.updateUuid=function(e,n,t){t?d().warn("try to update a component of id '"+e+"' with the new id '"+n+"' that is already used"):d().warn("try to update a component of id '"+e+"' with the new id '"+n+"'")},t.invalidUseOfComponent=function(e){d().warn("try to change the state of the destroyed component '"+e+"'")},t.invalidSchema=function(e){d().warn("the schema '"+e+"' is not valid")},t.invalidModel=function(e){d().warn("the model '"+e+"' is not valid")},t.invalidParameters=function(e){d().warn("the parameters for creating a component of class '"+e+"' are not compliant with the model")},t.destroyedComponentCall=function(e,n){d().warn("trying to get the property '"+e+"' on the destroyed component '"+n+"'")},t.invalidConctructorParameters=function(e,n){d().warn("the constructor parameter '"+JSON.stringify(e).replace(/,/g,", ")+"' for creating a component of class '"+n+"' is not an object")},t.unknownModel=function(e){d().warn("try get the information of an unknown model '"+e+"'")},t.missingSchema=function(e){d().warn("the schema '"+e+"' is missing")},t.cyclicDependency=function(e){e?d().error("a cyclic inheritance dependency with ’"+e+"’ schema has been found, please check the '_inherit' properties of your schemas"):d().error("a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas")},t.invalidEnumType=function(e,n,t){void 0!==t&&t!==typeof e?d().warn("invalid type for enumerated type '"+n+"': expected type '"+t+"' instead of type '"+typeof e+"'"):d().warn("invalid type for enumerated type '"+n+"'")},t.loadSchema=function(e){d().debug("load schema '"+e+"'")},t.loadModel=function(e){d().debug("load model '"+e+"'")},t.loadType=function(e){d().debug("load type '"+e+"'")},t.compileSchema=function(e){d().debug("compile schema '"+e+"'...")},t.generateModel=function(e){d().debug("generate model '"+e+"'...")},t.checkModel=function(e){d().debug("analyze model '"+e+"'...")},t.createCollection=function(e){d().debug("create collection '"+e+"'")},t.createClass=function(e){d().debug("create class '"+e+"'")},t.modelCreationBegin=function(){d().debug("starting model creation...")},t.modelCreationEnd=function(){d().debug("model creation ended")},t.actionInvokeError=function(e,n,t,r){"Function"!==t?d().error("error when trying to call the method '"+e+"' on component '"+n+"' (class '"+t+"'): "+r):d().error("error when trying to call the method '"+e+"' on component '"+n+"': "+r)},t.invalidSchemaProperty=function(e,n){d().warn("invalid property '"+n+"' for schema '"+e+"': only 'property', 'link', 'collection', 'method' and 'event' are allowed.")},t.invalidPropertyFormat=function(e){d().warn("invalid format for a definition of a property': '"+e+"' is not an object")},t.invalidState=function(e,n){d().warn("invalid state '"+n+"' for the model '"+e+"'")},t.unknownContext=function(e,n){d().warn("invoke the behavior '"+n+"' on the class '"+e+"' without a valid context")}},{"./component.js":3,"./db.js":4,"./metamodel.js":7}],7:[function(e,n,t){"use strict";var r=e("./db.js"),a=e("./log.js"),o=e("./component.js"),i=(e("./workflow.js"),e("./helper.js")),s="_id",d="_name",c="_description",l="_inherit",m="_class",u="_core",f=["property","collection","link","method","event"],p=["boolean","string","number","object","function","array","date","any"],y={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};function h(){var e="",n="",o="",i={},s="",c=null,l=null,m=null,u={},f={},p=[],h=0,g=0,v=0,_=0,b=[];for(o in y.compiledSchemas){u={_name:(i=y.compiledSchemas[o])._name},void 0!==i._core&&(u._core=i._core),Array.isArray(i._inherit)&&(u._inherit=i._inherit),void 0!==i._class&&(u._class=i._class),void 0!==i._description&&(u._description=i._description);for(e in i)switch(!0){case"property"===i[e]:u[e]={type:"any",readOnly:!1,mandatory:!1,default:"",description:e,label:e};break;case"link"===i[e]:u[e]={type:"_Component",readOnly:!1,mandatory:!1,default:"",description:e,label:e};break;case"method"===i[e]:u[e]={params:[{name:"param",type:"any",mandatory:!1}],result:"any",description:e};break;case"event"===i[e]:u[e]={params:[{name:"param",type:"any",mandatory:!1}],description:e};break;case"collection"===i[e]:u[e]={type:["_Component"],readOnly:!1,mandatory:!1,default:[],description:e,label:e};break;default:0!==e.indexOf("_")&&a.invalidSchemaProperty(i._name,e)}y.generatedModels[u._name]=u}for(s in y.generatedModels)n=(u=y.generatedModels[s])[d],(l=y.models[n])&&(f=P(l,u),y.generatedModels[n]=f);for(_=(b=function(){var e=[],n={},t="",r=0;for(t in y.inheritanceTree)r=y.inheritanceTree[t].length,void 0===n[r]&&(n[r]=[]),n[r].push(t);return Object.keys(n).sort().forEach(function(t){n[t].forEach(function(n){e.push(n)})}),e}()).length,g=0;g<_;g++)if(s=b[g],u=y.generatedModels[s]){(p=t.getParents(s)).reverse();JSON.parse(JSON.stringify(u));for(h=p.length,v=0;v<h;v++)n=p[v],(c=y.generatedModels[n])&&(f=P(c,u),y.generatedModels[s]=f);(l=y.models[s])&&(f=P(l,y.generatedModels[s]),y.generatedModels[s]=f)}for(s in y.generatedModels)m=y.generatedModels[s],r._GeneratedModel.insert(m),m._core||a.generateModel(s)}function g(){var e="",n=[];function t(e,n){var t=0,r=0,a=[];for(r=n.length,t=0;t<r;t++)0===n[t].indexOf(e)&&((a=n[t]).reverse(),a.pop(),a.reverse(),n[t]=a)}function r(e,n){var t=!0,r=0,a=0;for(a=n.length,r=0;r<a;r++)n[r].indexOf(e)>0&&(t=!1);return t}function o(e){var n=0,a=0,o=[];for(a=e.length,n=0;n<a;n++)if(r(e[n][0],e)){o.push(e[n][0]),t(e[n][0],e);break}return o}function i(e){var n=[],t=0,r=0;function s(e,n){var t=!1;return Array.isArray(y.inheritance[n])&&-1!==y.inheritance[n].indexOf(e)&&(a.cyclicDependency(e),t=!0),t}for(Array.isArray(y.inheritance[e])?n=y.inheritance[e].slice():a.missingSchema(e),r=n.length,t=0;t<r;t++)if(s(e,n[t])){n=[];break}return n.length?[e].concat(function(e){var n=[],t=[];for(t=o(e);void 0!==t[0];)n=n.concat(t),t=o(e);return function(e){var n=0,t=0,r=!0;for(t=e.length,n=0;n<t;n++)e[n].length&&(r=!1);return r}(e)||a.cyclicDependency(),n}(n.map(i).concat([n]))):[e]}for(e in y.inheritance)(n=i(e).reverse()).pop(),n.length&&(y.inheritanceTree[e]=n)}function v(e){var n={},t=y.schemas[e],r=y.inheritanceTree[e],a=0,o=0,i=null,s="";for(r&&(a=r.length,r.reverse()),o=0;o<a;o++){i=y.schemas[r[o]];for(s in i)0!==s.indexOf("_")&&(n[s]=i[s])}for(s in t)n[s]=t[s];return n}function _(e,n){var t="";for(t in n)t!==s&&t!==d&&t!==c&&t!==l&&t!==m&&t!==u&&(void 0!==e[t]?b(e[t],n[t])||a.invalidTypeImp(t,e[d]):a.missingPropertyImp(t,e[d]));for(t in e)t!==s&&t!==d&&t!==c&&t!==l&&t!==m&&t!==u&&void 0===n[t]&&a.unknownPropertyImp(t,e[d])}function b(e,n){return I(n,"string")&&-1!==p.indexOf(n)?I(e,n):w(e,n)}function w(e,n){var r=!0,a=y.type[n],o=0,i=0;if(I(a,"undefined"))r=!1;else if(I(e,"undefined"))r=!1;else if("array"===a.type)for(o=e.length,i=0;i<o&&!1!==(r=I(a.schema,"undefined")?t.isValidType(e[i],a.type):t.isValidSchema(e[i],a.schema));i++);else r=I(a.schema,"undefined")?t.isValidType(e,a.type):t.isValidSchema(e,a.schema);return r}function O(e){return e.replace("@","").trim()}function k(e){return I(e,"string")&&-1===p.indexOf(e)&&!t.isClassName(e)}function S(e){var n="";return n=Array.isArray(e)?"array":typeof e,"any"===e&&(n="any"),n}function j(e){var n="";return e&&e.constructor&&(n=e.constructor.name),n}function C(e,n){return-1!==n.indexOf(e)}function I(e,n){var t=!0,r=null;switch(n){case"array":t=Array.isArray(e);break;case"date":"string"==typeof e?(r=new Date(e),t=!isNaN(r.getDate())):t=e instanceof Date;break;case"any":t=!0;break;default:t=n===typeof e}return t}function M(e,n,t){var r=!1,a=y.generatedModels[n];return a&&a[d]&&(a=y.compiledSchemas[a[d]]),a&&a[e.split(".")[0]]===t&&(r=!0),r}function P(e,n,t){var r="",a=n;for(r in e)e.hasOwnProperty(r)&&0!==r.indexOf("_")&&(a[r]=e[r]);return a}t.schema=function(e){var n=null,o=null,c="",m={},u=[];o=JSON.parse(JSON.stringify(e)),c=o[d],void 0===o[s]&&(o[s]=i.generateId()),void 0===o[l]&&(o[l]=["_Component"]);return o[l]=function(e){var n=[],t={};return e.forEach(function(e){var r=e.trim();void 0===t[r]&&(t[r]=r,n.push(r))}),n}(o[l]),t.isValidObject(o,y.metadef.schema,!1)?(u=r._Schema.find({_name:c})).length?(m=P(o,u[0]),r._Schema.update({_name:c},m),n=u[0]._id):n=r._Schema.insert(o)[0]:a.invalidSchema(o[d]),n},t.model=function(e){var n=null,o=null,c="",l={},m=[];return n=JSON.parse(JSON.stringify(e)),c=n[d],void 0===n[s]&&(n[s]=i.generateId()),t.isValidObject(n,y.metadef.model,!1)?(m=r._Model.find({_name:c})).length?(l=P(n,m[0]),r._Model.update({_name:c},l),o=m[0]._id):o=r._Model.insert(n)[0]:a.invalidModel(n[d]),o},t.type=function(e){var n=null,o=e.name;return t.isValidObject(e,y.metadef.type)?n=r._Type.insert(e)[0]:a.invalidTypeDefinition(o),n},t.init=function(){t.clear(),y.metadef={schema:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1,default:["_Component"]},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},model:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},type:{_id:{type:"string",mandatory:!1},name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},schema:{type:"object",mandatory:!1},value:{type:["any"],mandatory:!1},core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}}},r.collection("_Logger"),r.collection("_Schema"),r.collection("_Model"),r.collection("_GeneratedModel"),r.collection("_ClassInfo"),r.collection("_Behavior"),r.collection("_State"),r.collection("_Type"),r.collection("_Message"),r.collection("_Channel"),r.collection("_Log")},t.clear=function(){y={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}},t.create=function(){a.modelCreationBegin(),function(){var e=[],n=[],t=null,o={},i=[],s=null,c="",m="",u=0,f=0;for(y.inheritance={},y.inheritanceTree={},y.schemas={},y.compiledSchemas={},y.models={},y.generatedModels={},y.states={},y.type={},f=(e=r._Schema.find({})).length,u=0;u<f;u++)c=(t=e[u])[d],m=t[l],y.schemas[c]=t,m&&(y.inheritance[c]=m),t._core||a.loadSchema(c);for(f=(i=r._Model.find({})).length,u=0;u<f;u++)c=(o=i[u])[d],y.models[c]=o,o._core||a.loadModel(c);for(f=(n=r._Type.find({})).length,u=0;u<f;u++)s=n[u],y.type[s.name]=s,s.core||a.loadType(s.name)}(),g(),function(){var e="";for(e in y.schemas)y.schemas[e]._core||a.compileSchema(e),y.compiledSchemas[e]=v(e)}(),h(),function(){var e="",n=null,t="";for(e in y.generatedModels)(n=y.generatedModels[e])&&((t=y.compiledSchemas[e])?(n._core||a.checkModel(e),_(n,t)):a.missingImplementation(e))}(),function(){var e="",n=null,t="",r=[],a="";for(e in y.compiledSchemas){if(r=[],n=y.compiledSchemas[e])for(a in n)t=n[a],0!==a.indexOf("_")&&-1!==f.indexOf(t)&&r.push(a);y.states[e]=r}}(),function(){var e="",n={};for(e in y.generatedModels)n=y.generatedModels[e],void 0===r[n[d]]&&!1!==n[m]&&(r.collection(n[d]),n._core||a.createCollection(n[d]))}(),function(){var e="",n={};for(e in y.generatedModels)!1!==(n=y.generatedModels[e])[m]&&(o.create({model:e}),n._core||a.createClass(e))}(),function(){var e="",n={},a="";for(e in y.generatedModels)a=(n=y.generatedModels[e])[d]+"Info",!1!==n[m]&&t.inheritFrom(n[d],"_Component")&&(o.get(a)?r._ClassInfo.update({_id:a},{_id:a,schema:y.compiledSchemas[e],model:n}):r._ClassInfo.insert({_id:a,schema:y.compiledSchemas[e],model:n}))}(),a.modelCreationEnd()},t.isEvent=function(e,n){return M(e,n,"event")},t.isProperty=function(e,n){return M(e,n,"property")},t.isLink=function(e,n){return M(e,n,"link")},t.isCollection=function(e,n){return M(e,n,"collection")},t.isMethod=function(e,n){return M(e,n,"method")},t.isStructure=function(e,n){var t=!1,r=y.generatedModels[n],a="";return r[e]&&(a=y.type[r[e].type]),a&&a.schema&&(t=!0),t},t.isValidState=function(e,n){var r=!1,a=y.generatedModels[n],o={};-1!==e.indexOf(".")?r=t.isValidModelPath(n,e):(a&&a[d]&&(a=y.generatedModels[a[d]]),o=y.states[a[d]],Array.isArray(o)&&(r=-1!==o.indexOf(e)));return r},t.isValidType=function(e,n){var r=!0;function i(e,n){var t=!0,r=O(n),i=e;return""!==e&&null!==e&&(I(e,"string")&&(i=o.get(e)),j(i)!==r&&"{}"!==JSON.stringify(i)&&(t=!1,a.invalidType(e,n.replace("@","")))),t}switch(!0){case k(n):(r=w(e,n))||(y.type[n]?a.invalidEnumType(e,n,y.type[n].type):a.invalidEnumType(e,n)),r&&(r=function(e,n){var t=y.type[n],r=!0;return Array.isArray(t.value)&&-1===t.value.indexOf(e)&&(r=!1),!1===r&&a.invalidEnumValue(e,n),r}(e,n));break;case t.isClassName(n):r=i(e,n);break;default:r=function(e,n){var r=!0,a=0,o=0;switch(S(n)){case"string":r=I(e,n);break;case"array":for(o=e.length,a=0;a<o;a++)switch(!0){case k(n[0]):r=w(e[a],n[0]);break;case t.isClassName(n[0]):r=i(e[a],n[0]);break;default:r=I(e[a],n[0])}}return r}(e,n)}return r},t.isValidEnum=function(e,n){var r=!0;return t.isClassName(n.type)?(r=function(e,n){var t="";return"Function"===(t=e.constructor.name)&&(t=e.name),t===n}(o.get(e),O(n.type))&&-1!==n.value.indexOf(e))||a.invalidEnumValue(e,n.type):(r=I(e,n.type)&&-1!==n.value.indexOf(e))||a.invalidEnumValue(e,n.name),r},t.isValidSchema=function e(n,r){var o="",i=null,s=!0,d="",c="",l="",m=0,u=0;function f(){var r=!0,s=[];return c=j(d),k(c=(c=n[c]).replace("@",""))?y.type[c]?y.type[c].schema?r=e(i,y.type[c].schema):(r=I(i,y.type[c].type),(s=y.type[c].value)&&(r=C(i,s))):r=!1:r="array"===c?Array.isArray(i):t.isClassName(c)?I(i,"object")||I(i,"string"):I(i,c),r||a.invalidPropertyType(o,c,i),r}function p(){var r=!0,s=[];c=d.replace("{","").replace("}","").trim();return k(c=(c=n[c]).replace("@",""))?y.type[c]?y.type[c].schema?r=e(i,y.type[c].schema):(r=I(i,y.type[c].type),(s=y.type[c].value)&&(r=C(i,s))):r=!1:r="array"===c?Array.isArray(i):t.isClassName(c)?I(i,"object")||I(i,"string"):I(i,c),r||a.invalidPropertyType(o,c,i),r}function h(){var n=!0;switch(l=S(d)){case"string":if(k(l))n=e(i,d);else if(!I(i,d)){a.invalidPropertyType(o,d,i),n=!1;break}break;case"array":for(m=i.length,u=0;u<m;u++)if(k(d[0]))n=e(i[u],y.type[d[0]].schema);else if(!I(i[u],d[0])){a.invalidPropertyType(i[u],d[0],i[u]),n=!1;break}}return n}if(I(n,"object")){for(o in n){if(i=n[o],I(r[o],"undefined"))return a.unknownProperty(o,r),!1;switch(d=r[o].type,!0){case t.isClassName(d):s=f();break;case-1!==d.indexOf("{"):s=p();break;default:s=h()}if(!s)break}for(o in r)if(!0===(i=r[o]).mandatory&&I(n[o],"undefined")&&void 0!==n[o]){a.missingProperty(o),s=!1;break}}else s=!1,a.invalidPropertyFormat(n);return s},t.isValidObject=function e(n,r,i,s){var d="",c=null,l=!0,m=!0,u="",f="",p="",h=0,g=0;I(i,"undefined")&&(i=!0),I(s,"undefined")&&(s=!1);function v(n,r){var a=!0,o="";if(o=y.type[r])switch(!0){case!I(o.schema,"undefined"):a=e(n,o.schema,i,s);break;case!I(o.value,"undefined"):a=t.isValidEnum(n,o);break;default:a=t.isValidType(n,o.type)}else a=!1;return a}function _(e,r){var i=!0,c=null,l=!1;if(f=O(r),e&&e.id?(c=e,l=!0):c=o.get(e),I(c,"undefined"))switch(!0){case I(e,"object")&&null!==e&&Object.keys(e).length>0:case I(e,"string")&&""!==e:a.canNotYetValidate(e,f)}else t.inheritFrom(c.constructor.name,f)?l&&s&&(n[d]=c.id()):(i=!1,a.invalidType(e,f));return i}function b(n,r){var c=!0,l=null,m="";switch(p=S(r)){case"any":break;case"string":if(k(p))c=e(n,r,i,s);else if("array"===r){if("array"!==S(n)){a.invalidPropertyType(d,r,n),c=!1;break}}else if("date"===r){if(l=new Date(n),!(c=!isNaN(l.getDate()))){a.invalidPropertyType(d,r,n);break}}else if(S(n)!==r&&"any"!==S(n)){a.invalidPropertyType(d,r,n),c=!1;break}break;case"array":if(Array.isArray(n)){for(h=n.length,m=r[0],g=0;g<h;g++)if(k(m))c=v(n[g],m);else if(t.isClassName(m))if("string"===S(n[g]))if(o.get(n[g])){if(!t.inheritFrom(j(o.get(n[g])),O(m))){a.invalidClassName(JSON.stringify(n[g]),O(m),j(o.get(n[g]))),c=!1;break}}else""!==n[g]&&a.canNotYetValidate(n[g],O(m));else{if(!t.inheritFrom(j(n[g]),O(m))){a.invalidClassName(JSON.stringify(n[g]),O(m),j(n[g])),c=!1;break}s&&(n[g]=n[g].id())}else if(S(n[g])!==m&&"any"!==m){a.invalidPropertyType(n[g],m,n[g]),c=!1;break}}else c=!1,a.invalidType(n,"array");break;default:c=!1,a.unknownType(n)}return c}I(n,"object")||(l=!1,a.invalidType(n,"object"));for(d in n)if(c=n[d],I(r[d],"undefined")&&"_core"!==d){if(i)return a.unknownProperty(d,r),!1}else switch(u="_core"!==d?r[d].type:"boolean","_id"===d&&(u="string"),!0){case k(u):l=v(c,u);break;case t.isClassName(u):l=_(c,u);break;default:l=b(c,u)}for(d in r)m=(c=r[d]).mandatory,n&&I(n[d],"undefined")&&!0===m&&(a.missingProperty(d),l=!1);return l},t.prepareObject=function(e,n){var t="",r=null,a=!0,o="";for(t in n)a=(r=n[t]).mandatory,o=r.default,I(e[t],"undefined")&&(!1!==a||I(o,"undefined")||(e[t]=o))},t.getSchema=function(e){var n=null;return y.compiledSchemas[e]&&(n=y.compiledSchemas[e]),n},t.getModel=function(e){var n=null;return y.generatedModels[e]&&(n=y.generatedModels[e]),n},t.getType=function(e){var n=null;return y.type[e]&&y.type[e]&&(n=JSON.parse(JSON.stringify(y.type[e]))),n},t.getModelPathType=function(e,n){var r=null,o=[],i="",s=0,d=0,c="";for(d=(o=n.split(".")).length,s=0;s<d;s++)i=o[s],0===s?r=t.getModel(e)[i].type:k(r)&&(c=t.getType(r)).schema?r=c.schema[i].type:a.invalidState(e,n);return r},t.isValidModelPath=function(e,n){var r=!0,a=null,o=[],i="",s=0,d=0,c="";for(d=(o=n.split(".")).length,s=0;s<d;s++)i=o[s],0===s?a=t.getModel(e)[i].type:k(a)&&(c=t.getType(a)).schema&&c.schema[i]?a=c.schema[i].type:r=!1;return r},t.getMetaDef=function(){return y.metadef.schema},t.getParents=function(e){return y.inheritanceTree[e]?y.inheritanceTree[e].slice():[]},t.inheritFrom=function(e,n){var r=!1,a=[],o=0,i=0;function s(e,n){var r=!1,a=[],o=0;if(0!==(a=t.getParents(e)).length)if(-1!==a.indexOf(n))r=!0;else for(o=0;o<0&&!(r=s(a[o],n));o++);return r}if(e!==n){if(i=(a=t.getParents(e)).length,0!==a.length)if(-1!==a.indexOf(n))r=!0;else for(o=0;o<i&&!(r=s(a[o],n));o++);}else r=!0;return r},t.isClassName=function(e){var n="",t=I(e,"string");return t&&(Object.keys(y.generatedModels).length>0?(n=e.replace("@",""),t=void 0!==y.generatedModels[n]):t=!1),t}},{"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./workflow.js":10}],8:[function(e,n,t){(function(t){"use strict";"undefined"==typeof window&&void 0!==t&&(t.require=e);var r=e("./db.js"),a=e("./component.js"),o=e("./metamodel.js"),i=e("../build/system/system.js"),s="",d="",c=null;e("./helper.js").polyfill(),o.init(),s=r.importSystem(i.system),d=a.get(s),c=a.get("channel"),d.state("installed"),c.$systemInstalled(s),d.state("resolved"),c.$systemResolved(s),d.state("starting"),c.$systemStarted(s),d.start(),d.state("active"),n.exports=a.get("runtime")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../build/system/system.js":1,"./component.js":3,"./db.js":4,"./helper.js":5,"./metamodel.js":7}],9:[function(e,n,t){"use strict";var r=e("./db.js"),a={};t.set=function(e,n,t){a[e]={state:n,value:t},r.store._State[e]={state:n,value:t}},t.get=function(e){return a[e]},t.clear=function(){a={}}},{"./db.js":4}],10:[function(e,n,t){"use strict";var r=e("./metamodel.js"),a=e("./component.js"),o=e("./behavior.js"),i=e("./state.js"),s=e("./helper.js"),d=e("./log.js"),c=e("./db.js");function l(e){this.message=e,this.name="RuntimeError"}(l.prototype=new Error).constructor=l;function m(e){return-1!==e.indexOf(".")}function u(e,n){var t=null,a=[],o=[],i=0,s=0,c=0,l=0;if(r.getModel(e)?t=r.getModel(e)[n]:d.unknownModel(e),t){if(a=t.params)for(i=a.length,s=0;s<i;s++)void 0!==a[s].mandatory&&!0!==a[s].mandatory||(c+=1),l+=1;o.push(c),o.push(l)}else d.unknownMethod(e,n);return o}function f(e){var n=(e=e||{}).component||null,t=e.methodName||"",a=null,o="",i=null,s=!0;if(a=void 0!==e.methodResult?e.methodResult:void 0,null!==(i=function(e,n){var t=null,a=null;return r.getModel(e)?t=r.getModel(e)[n].result:d.unknownModel(e),t&&(a=t),a}("Function"===n.constructor.name?n.name:n.constructor.name,t)))switch(!0){case"any"===i:break;case"array"===i:Array.isArray(a)||(s=!1,d.invalidResultType(n.id(),n.constructor.name,t,i,null));break;case r.isClassName(i):a.constructor?(o="Function"===a.constructor.name?a.name:a.constructor.name)!==i.replace("@","")&&(s=!1,d.invalidResultType(n.id(),n.constructor.name,t,i,o)):(s=!1,d.invalidResultType(n.id(),n.constructor.name,t,i,typeof a));break;default:typeof a!==i&&(s=!1,d.invalidResultType(n.id(),n.constructor.name,t,i,typeof a))}return s}function p(e,n,t){var i=o.getActions(e.id(),n),s=[],c=0,l=0,m=null;if(!i.length||t)if("Function"!==e.constructor.name)i=i.concat(p(a.get(e.constructor.name),n,t));else for(c=(s=r.getParents(e.name)).length,l=0;l<c&&((m=a.get(s[l]))?i=i.concat(p(m,n,t)):d.unknownComponent(s[l],e.name),!i.length);l++);return i.length&&i.reverse(),i}function y(e,n,m,u,f){var p=null,y=[],h="",g=0,v=0;h="Function"===e.constructor.name?e.name:e.constructor.name,r.isProperty(n,h)||r.isLink(n,h)||r.isCollection(n,h)||(u=function(e,n,t){var a=null,o=[],i=[],s=0,c=0;if(a=r.getModel(e)[n]){if(o=a.params)for(s=o.length,c=0;c<s;c++)!1===o[c].mandatory&&void 0===t[c]?i.push(o[c].default):i.push(t[c])}else d.unknownMethod(e,n);return i}(h,n,u));try{for(v=u.length,g=0;g<v;g++)y.push(u[g]);m.useCoreAPI&&(y.push(a),y.push(c),y.push(r),y.push(t),y.push(o),y.push(i),y.push(d)),f?setTimeout(m.action.bind.apply(m.action,[e].concat(y)),0):p=m.action.apply(e,y)}catch(t){if(t instanceof l)throw t;void 0===new Function?console.error("runtime: can not execute new Function() instruction in the current context."):(e&&e.error&&e.error({message:"error when trying to call the method '"+n+"' on component '"+e.id()+"'",error:t}),s.getRuntime()&&s.getRuntime().error({message:"error when trying to call the method '"+n+"' on component '"+e.id()+"'",error:t}),d.actionInvokeError(n,e.id(),e.constructor.name,t.message))}return p}t.validParamNumbers=function(e,n,t){var a="",o=-1,i="",s=[],d=0,c=[],l=!1,m=!1,f=!1,p=!1;switch(o=(a=t.toString()).indexOf("{"),""===(s=(-1!==(i=(i=a.substring(0,o)).replace("=>","")).indexOf("(")?i.split("(")[1].replace(")","").trim():i.trim()).split(","))[0]&&(s=[]),d=s.length,l=r.isProperty(n,e),m=r.isLink(n,e),f=r.isCollection(n,e),!0){case f:c=[2,2];break;case l:c="array"===r.getModelPathType(e,n)?[2,2]:[1,1];break;case m:c=[1,1];break;default:c=u(e,n)}return c[0]<=d&&d<=c[1]&&(p=!0),p},t.checkParams=function(e){var n=(e=e||{}).component||null,t=e.methodName||"",a=e.args||"",o=[],i=[],s=[],c="",l=a.length,f=0,p=null,y=!0,h=!1,g=!1,v=!1;switch(c="Function"===n.constructor.name?n.name:n.constructor.name,h=r.isProperty(t,c),g=r.isLink(t,c),v=r.isCollection(t,c),o=function(e,n){var t=null,a=[],o=[],i=0,s=0;if(r.getModel(e)?t=r.getModel(e)[n]:d.unknownModel(e),t){if(a=t.params)for(i=a.length,s=0;s<i;s++)o.push(a[s].name)}else m(n)||d.unknownMethod(e,n);return o}(c,t),!0){case v:i=a&&a[1]&&"reset"===a[1]?[[r.getModel(c)[t].type[0]],"string"]:[r.getModel(c)[t].type[0],"string"],s=[2,2];break;case h:i=m(t)?[r.getModelPathType(c,t)]:[r.getModel(c)[t].type],"array"===r.getModelPathType(c,t)?(i=a&&a[1]&&"reset"===a[1]?[["any"],"string"]:["any","string"],s=[2,2]):s=[1,1];break;case g:i=[r.getModel(c)[t].type],s=[1,1];break;default:i=function(e,n){var t=null,a=[],o=[],i=0,s=0;if(r.getModel(e)?t=r.getModel(e)[n]:d.unknownModel(e),t){if(a=t.params)for(i=a.length,s=0;s<i;s++)o.push(a[s].type)}else d.unknownMethod(e,n);return o}(c,t),s=u(c,t)}for(void 0===l&&(l=1),(l<s[0]||s[1]<l)&&(y=!1,d.invalidParamNumber(n.id(),n.constructor.name,t)),f=0;f<l;f++)if(void 0===(p=a[f])){if(!(f<s[0]))continue;y=!1,d.invalidParamNumber(n.id(),n.constructor.name,t)}else r.isValidType(p,i[f])||(y=!1,d.invalidParamType(n.id(),n.constructor.name,t,o[f]));return y},t.action=function(e,n){var t=!1,i=!1,s=!1,d=!1,l=[],m=null,u=null,f="",p=null;l=c._Behavior.find({_id:e}),p=o.get(e),1===l.length&&(m=l[0],(u=a.get(m.component))&&(f="Function"===u.constructor.name?u.name:u.constructor.name,t=r.isEvent(m.state,f),i=r.isProperty(m.state,f),s=r.isLink(m.state,f),d=r.isCollection(m.state,f),(t||i||d||s)&&y(u,m.state,{useCoreAPI:m.useCoreAPI,action:p},n,!0)))},t.state=function(e){(e=e||{}).component=e.component||"",e.state=e.state||"",e.data=e.data||[],e.context=e.context||null;var n=null,o="",s=[],c=null,l=null,m=0,u=0,h=!1,g=!1,v=!1,_=!1,b=!1;if((o=i.get(e.component))&&"destroy"===o.state&&d.invalidUseOfComponent(e.component),(n=a.get(e.component))&&(h="Function"===n.constructor.name?n.name:n.constructor.name,b=r.isEvent(e.state,h),g=r.isProperty(e.state,h),v=r.isLink(e.state,h),_=r.isCollection(e.state,h),s=p(n,e.state,b)),s.length){if(t.checkParams({component:n,methodName:e.state,args:e.data}))if(b||g||v||_){for(u=s.length,m=0;m<u;m++)c=s[m],y(e.context||n,e.state,c,e.data,!0);i.set(n.id(),e.state,e.data)}else c=s[0],l=y(e.context||n,e.state,c,e.data,!1),f({component:n,methodName:e.state,methodResult:l});return l}n&&(b||g||v||_)&&i.set(n.id(),e.state,e.data)},t.stop=function(e){if(void 0===(e=e||{}).error&&(e.error=!1),e.message=e.message||"",t.state=function(){},e.error)throw e.message?new l("runtime has been stopped because "+e.message):new l("runtime has been stopped because of an unknown error");e.message?console.error("runtime: runtime has been stopped because "+e.message):console.error("runtime: runtime has been stopped")}},{"./behavior.js":2,"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9}]},{},[8])(8)});